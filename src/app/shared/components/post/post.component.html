<StackLayout class="rounded-lg bg-white px-3 pt-3 pb-2 mb-4">
  <GridLayout rows="*, auto, auto, *" columns="48, *, auto" class="mb-2 h-10">
    <NSImg
      row="0"
      rowSpan="4"
      col="0"
      [src]="post.account.avatar"
      failureImageUri="font://&#xeb4d;"
      class="tabler-icon text-neutral-500 text-4xl rounded-full w-10 h-10 mr-2"
      [decodeWidth]="200"
      [decodeHeight]="200"
    ></NSImg>
    <FlexboxLayout class="mr-2 items-center" row="1" col="1">
      <Label
        class="text-xs font-medium no-font-padding"
        [text]="post.account.displayName"
      ></Label>
      @if (status()) {
        <Label
          [text]="' - ' + status()"
          class="text-xs text-neutral-500 shrink-0 no-font-padding"
        ></Label>
      }
    </FlexboxLayout>
    <Label
      row="2"
      col="1"
      [text]="post.createdAt | date: 'MMM dd, yyyy hh:mm a'"
      class="text-xs text-neutral-500 mr-2 mt-0.5 no-font-padding"
    ></Label>
    @if (noteProgress()?.type || noteProgress()?.value) {
      <Label
        rowSpan="2"
        row="1"
        col="2"
        [text]="
          ('common.' + noteProgress().type | L) + ': ' + noteProgress().value
        "
        class="bg-neutral-200 rounded-lg text-xs h-6 px-2.5 no-font-padding"
      ></Label>
    } @else {
      <FlexboxLayout class="justify-between h-3 w-[76]" row="1" col="2">
        @for (rateIndicator of rateIndicators(); track $index) {
          <ns-rate-indicator
            [rate]="rateIndicator"
            [size]="12"
          ></ns-rate-indicator>
        }
      </FlexboxLayout>
    }
  </GridLayout>
  <GridLayout columns="*" rows="*">
    <StackLayout row="0" col="0">
      @if (title()) {
        <Label class="text-center mb-4 font-bold" [text]="title()"></Label>
      }
      @for (line of commentParts(); track $index) {
        <WrapLayout orientation="horizontal" class="mb-2">
          @for (part of line; track $index) {
            @if (part.type === "emoji") {
              <NSImg
                [src]="part.url"
                height="20"
                width="20"
                stretch="aspectFit"
              ></NSImg>
            } @else {
              <Label
                [text]="part.text"
                class="text-sm"
                [ngClass]="
                  part.type === 'mention' ||
                  part.type === 'hashtag' ||
                  part.type === 'link'
                    ? 'text-forest font-medium'
                    : part.type === 'spoiler' && !revealContent()
                      ? 'text-transparent text-shadow-[0_0_8_black]'
                      : ''
                "
                (tap)="onPartTap(part)"
                textWrap="true"
              ></Label>
            }
          }
        </WrapLayout>
      }
    </StackLayout>
    <!-- TODO: Mohammad 10-12-2025: Could be useful for replies -->
    <!-- @if ((post.sensitive) && !revealContent()) {
      <FlexboxLayout
        class="min-h-full bg-neutral-100 flex-col rounded-lg justify-center p-4 mb-2"
        row="0"
        col="0"
        (tap)="revealContent.set(true)"
      >
        <Label
          class="text-center"
          [text]="'common.sensitive_content' | L"
        ></Label>
        <Label
          [text]="'common.show' | L"
          class="text-center text-forest font-bold mt-4"
        ></Label>
      </FlexboxLayout>
    } -->
  </GridLayout>
  <FlexboxLayout class="border-t-[1] border-neutral-200 justify-between w-full">
    <StackLayout orientation="horizontal" class="p-2">
      <Label text="&#xeaed;" class="tabler-icon text-neutral-500 mr-1"></Label>
      <Label
        [text]="post.repliesCount ? (post.repliesCount | kilo) : ''"
        class="text-neutral-500 text-xs"
      ></Label>
    </StackLayout>
    <StackLayout orientation="horizontal" class="p-2">
      <Label text="&#xeb72;" class="tabler-icon text-neutral-500 mr-1"></Label>
      <Label
        [text]="post.reblogsCount ? (post.reblogsCount | kilo) : ''"
        class="text-neutral-500 text-xs"
      ></Label>
    </StackLayout>
    <StackLayout orientation="horizontal" class="p-2">
      <Label text="&#xeabe;" class="tabler-icon text-neutral-500 mr-1"></Label>
      <Label
        [text]="post.favouritesCount ? (post.favouritesCount | kilo) : ''"
        class="text-neutral-500 text-xs"
      ></Label>
    </StackLayout>
  </FlexboxLayout>
</StackLayout>
