<Label
  [text]="'common.user_ratings_and_marks' | L"
  class="h1 mx-4 mb-2 mt-6"
></Label>
@if (item.rating > 0) {
  <StackLayout class="mx-4 mb-4">
    <ns-ratings-chart
      [rating]="item.rating"
      [ratingCount]="item.ratingCount"
      [ratingDistribution]="item.ratingDistribution"
    ></ns-ratings-chart>
  </StackLayout>
}

<StackLayout class="px-4 pt-4 bg-primary-300-15">
  <Button
    [text]="
      postsStateService.itemPosts[item.uuid]?.userStatus()
        ? postsStateService.itemPosts[item.uuid]?.userStatus() +
          (postsStateService.itemPosts[item.uuid]?.userMark().ratingGrade
            ? ' - ' +
              postsStateService.itemPosts[item.uuid]?.userMark().ratingGrade
            : '')
        : ('common.mark_and_rate' | L)
    "
    class="primary-button w-full mb-4"
    (tap)="
      postEditorsService.showMarkAndRateSheet(containerRef, {
        itemUUID: item.uuid,
        itemCategory: item.category,
        itemTitle: itemTitle,
        shelfMark: postsStateService.itemPosts[item.uuid]?.userMark(),
      })
    "
  ></Button>
  @for (
    comment of postsStateService.itemPosts[item.uuid]?.commentsOverview();
    track comment
  ) {
    <ns-post-item
      [post]="comment"
      [isLiking]="postsStateService.likingPostIds().includes(comment.id)"
      [isBoosting]="postsStateService.boostingPostIds().includes(comment.id)"
      [isEditable]="comment.account.id === stateService.fediAccount().id"
      [itemCategory]="item.category"
      (likePressed)="postsStateService.toggleLike(comment)"
      (boostPressed)="postsStateService.toggleBoost(comment)"
      (editPressed)="
        postEditorsService.showMarkAndRateSheet(containerRef, {
          itemUUID: item.uuid,
          itemCategory: item.category,
          itemTitle: itemTitle,
          shelfMark: postsStateService.itemPosts[item.uuid].userMark(),
        })
      "
      (replyPressed)="
        postEditorsService.showReplySheet(containerRef, {
          replyingPost: comment,
        })
      "
      (postPressed)="navigateToPost(comment.id, 'mark')"
    ></ns-post-item>
  }
  @if (postsStateService.itemPosts[item.uuid]?.hasMoreComments()) {
    <Button
      [text]="'common.show_all' | L"
      class="basic-button mb-4"
      (tap)="showAllPosts('mark')"
    ></Button>
  }
</StackLayout>

<Label [text]="'common.reviews' | L" class="h1 mx-4 mb-2 mt-6"></Label>
<StackLayout class="px-4 pt-4 bg-primary-300-15">
  <Button
    [text]="
      (postsStateService.itemPosts[item.uuid]?.userReview()
        ? 'common.modify_review'
        : 'common.write_review'
      ) | L
    "
    class="primary-button w-full mb-4"
    (tap)="
      postEditorsService.showReviewSheet(containerRef, {
        itemUUID: item.uuid,
        itemCategory: item.category,
        itemTitle: itemTitle,
        review: postsStateService.itemPosts[item.uuid]?.userReview(),
      })
    "
  ></Button>
  @for (
    review of postsStateService.itemPosts[item.uuid]?.reviewsOverview();
    track review
  ) {
    <ns-post-item
      [post]="review"
      [isLiking]="postsStateService.likingPostIds().includes(review.id)"
      [isBoosting]="postsStateService.boostingPostIds().includes(review.id)"
      [isEditable]="review.account.id === stateService.fediAccount().id"
      [itemCategory]="item.category"
      (likePressed)="postsStateService.toggleLike(review)"
      (boostPressed)="postsStateService.toggleBoost(review)"
      (editPressed)="
        postEditorsService.showReviewSheet(containerRef, {
          itemUUID: item.uuid,
          itemCategory: item.category,
          itemTitle: itemTitle,
          review: postsStateService.itemPosts[item.uuid].userReview(),
        })
      "
      (replyPressed)="
        postEditorsService.showReplySheet(containerRef, {
          replyingPost: review,
        })
      "
      (postPressed)="navigateToPost(review.id, 'review')"
    ></ns-post-item>
  }
  @if (postsStateService.itemPosts[item.uuid]?.hasMoreReviews()) {
    <Button
      [text]="'common.show_all' | L"
      class="basic-button mb-4"
      (tap)="showAllPosts('review')"
    ></Button>
  }
</StackLayout>

<Label [text]="'common.notes' | L" class="h1 mx-4 mb-2 mt-6"></Label>
<StackLayout class="px-4 pt-4 bg-primary-300-15">
  <Button
    [text]="'common.write_note' | L"
    class="primary-button w-full mb-4"
    (tap)="
      postEditorsService.showNoteSheet(containerRef, {
        itemUUID: item.uuid,
        itemCategory: item.category,
        itemTitle: itemTitle,
      })
    "
  ></Button>
  @for (
    note of postsStateService.itemPosts[item.uuid]?.notesOverview();
    track note
  ) {
    <ns-post-item
      [post]="note"
      [isLiking]="postsStateService.likingPostIds().includes(note.id)"
      [isBoosting]="postsStateService.boostingPostIds().includes(note.id)"
      [isEditable]="note.account.id === stateService.fediAccount().id"
      [itemCategory]="item.category"
      (likePressed)="postsStateService.toggleLike(note)"
      (boostPressed)="postsStateService.toggleBoost(note)"
      (editPressed)="
        postEditorsService.showNoteSheet(containerRef, {
          itemUUID: item.uuid,
          itemCategory: item.category,
          itemTitle: itemTitle,
          note: postsStateService.getUserNoteByPost(note),
        })
      "
      (replyPressed)="
        postEditorsService.showReplySheet(containerRef, {
          replyingPost: note,
        })
      "
      (postPressed)="navigateToPost(note.id, 'note')"
    ></ns-post-item>
  }
  @if (postsStateService.itemPosts[item.uuid]?.hasMoreNotes()) {
    <Button
      [text]="'common.show_all' | L"
      class="basic-button mb-4"
      (tap)="showAllPosts('note')"
    ></Button>
  }
</StackLayout>
